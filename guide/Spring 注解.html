<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring注解 | 面向对象Coding</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script>
            var _hmt = _hmt || [];
            (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?634681ee52ddf5b1f6ff2c69397bda83";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
            })();
            
            </script>
    <meta name="description" content="oopCoding">
    
    <link rel="preload" href="/vue-press/assets/css/0.styles.a7b48b74.css" as="style"><link rel="preload" href="/vue-press/assets/js/app.8857885a.js" as="script"><link rel="preload" href="/vue-press/assets/js/2.c05b7fa4.js" as="script"><link rel="preload" href="/vue-press/assets/js/43.b9f83c8a.js" as="script"><link rel="prefetch" href="/vue-press/assets/js/10.c3630bc0.js"><link rel="prefetch" href="/vue-press/assets/js/11.19806737.js"><link rel="prefetch" href="/vue-press/assets/js/12.f01bacfb.js"><link rel="prefetch" href="/vue-press/assets/js/13.69e815f0.js"><link rel="prefetch" href="/vue-press/assets/js/14.0a5e1b2f.js"><link rel="prefetch" href="/vue-press/assets/js/15.6f04d84b.js"><link rel="prefetch" href="/vue-press/assets/js/16.99b7d4e9.js"><link rel="prefetch" href="/vue-press/assets/js/17.5095a14a.js"><link rel="prefetch" href="/vue-press/assets/js/18.acc9c901.js"><link rel="prefetch" href="/vue-press/assets/js/19.ca2d73b4.js"><link rel="prefetch" href="/vue-press/assets/js/20.47c3e77e.js"><link rel="prefetch" href="/vue-press/assets/js/21.dfa37998.js"><link rel="prefetch" href="/vue-press/assets/js/22.201c1c4e.js"><link rel="prefetch" href="/vue-press/assets/js/23.f196e442.js"><link rel="prefetch" href="/vue-press/assets/js/24.b6941784.js"><link rel="prefetch" href="/vue-press/assets/js/25.8c119899.js"><link rel="prefetch" href="/vue-press/assets/js/26.00f7470d.js"><link rel="prefetch" href="/vue-press/assets/js/27.cfb3a0b2.js"><link rel="prefetch" href="/vue-press/assets/js/28.7fdd6be5.js"><link rel="prefetch" href="/vue-press/assets/js/29.c4f336ea.js"><link rel="prefetch" href="/vue-press/assets/js/3.8ea11f8e.js"><link rel="prefetch" href="/vue-press/assets/js/30.4b94204f.js"><link rel="prefetch" href="/vue-press/assets/js/31.7937a76c.js"><link rel="prefetch" href="/vue-press/assets/js/32.356c0006.js"><link rel="prefetch" href="/vue-press/assets/js/33.e33d865a.js"><link rel="prefetch" href="/vue-press/assets/js/34.df71d62e.js"><link rel="prefetch" href="/vue-press/assets/js/35.4226698a.js"><link rel="prefetch" href="/vue-press/assets/js/36.4d01d025.js"><link rel="prefetch" href="/vue-press/assets/js/37.c53a709d.js"><link rel="prefetch" href="/vue-press/assets/js/38.f4905a78.js"><link rel="prefetch" href="/vue-press/assets/js/39.4e952ee6.js"><link rel="prefetch" href="/vue-press/assets/js/4.5a363195.js"><link rel="prefetch" href="/vue-press/assets/js/40.fce62c8f.js"><link rel="prefetch" href="/vue-press/assets/js/41.46c1dfe2.js"><link rel="prefetch" href="/vue-press/assets/js/42.5616e3e3.js"><link rel="prefetch" href="/vue-press/assets/js/44.cfe7bf29.js"><link rel="prefetch" href="/vue-press/assets/js/45.dc3f54ba.js"><link rel="prefetch" href="/vue-press/assets/js/46.f063949d.js"><link rel="prefetch" href="/vue-press/assets/js/47.43e45385.js"><link rel="prefetch" href="/vue-press/assets/js/48.299006a2.js"><link rel="prefetch" href="/vue-press/assets/js/49.7cd3afd3.js"><link rel="prefetch" href="/vue-press/assets/js/5.dfff2508.js"><link rel="prefetch" href="/vue-press/assets/js/50.c3c8025f.js"><link rel="prefetch" href="/vue-press/assets/js/51.7d2ddfde.js"><link rel="prefetch" href="/vue-press/assets/js/52.fff13010.js"><link rel="prefetch" href="/vue-press/assets/js/53.f4c30126.js"><link rel="prefetch" href="/vue-press/assets/js/54.66a127d0.js"><link rel="prefetch" href="/vue-press/assets/js/55.aa83320e.js"><link rel="prefetch" href="/vue-press/assets/js/56.36258450.js"><link rel="prefetch" href="/vue-press/assets/js/57.13c74748.js"><link rel="prefetch" href="/vue-press/assets/js/58.477544ce.js"><link rel="prefetch" href="/vue-press/assets/js/59.418b3fb1.js"><link rel="prefetch" href="/vue-press/assets/js/6.efb1059d.js"><link rel="prefetch" href="/vue-press/assets/js/60.cd59e3e3.js"><link rel="prefetch" href="/vue-press/assets/js/61.e3b2f495.js"><link rel="prefetch" href="/vue-press/assets/js/62.cee3df47.js"><link rel="prefetch" href="/vue-press/assets/js/63.240e4da3.js"><link rel="prefetch" href="/vue-press/assets/js/64.386ee013.js"><link rel="prefetch" href="/vue-press/assets/js/65.e9c8b285.js"><link rel="prefetch" href="/vue-press/assets/js/66.4f91bd49.js"><link rel="prefetch" href="/vue-press/assets/js/67.5891e088.js"><link rel="prefetch" href="/vue-press/assets/js/7.fdc9ea19.js"><link rel="prefetch" href="/vue-press/assets/js/8.47da94a6.js"><link rel="prefetch" href="/vue-press/assets/js/9.953ba650.js">
    <link rel="stylesheet" href="/vue-press/assets/css/0.styles.a7b48b74.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vue-press/" class="home-link router-link-active"><!----> <span class="site-name">面向对象Coding</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue-press/guide/" class="nav-link router-link-active">
  指南
</a></div><div class="nav-item"><a href="/interview/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  面试宝典
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/vue-press/wechat/" class="nav-link">
  公号文章
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工具" class="dropdown-title"><span class="title">后端工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端工具" class="mobile-dropdown-title"><span class="title">后端工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.vuepress.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vuepress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://mvnrepository.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  maven
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工具" class="dropdown-title"><span class="title">前端工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端工具" class="mobile-dropdown-title"><span class="title">前端工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue-press/guide/https/www.vuepress.org.html" class="nav-link">
  vuepress
</a></li><li class="dropdown-item"><!----> <a href="https://www.vue.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/changeLog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  changeLog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue-press/guide/" class="nav-link router-link-active">
  指南
</a></div><div class="nav-item"><a href="/interview/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  面试宝典
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/vue-press/wechat/" class="nav-link">
  公号文章
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工具" class="dropdown-title"><span class="title">后端工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端工具" class="mobile-dropdown-title"><span class="title">后端工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.vuepress.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vuepress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://mvnrepository.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  maven
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工具" class="dropdown-title"><span class="title">前端工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端工具" class="mobile-dropdown-title"><span class="title">前端工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue-press/guide/https/www.vuepress.org.html" class="nav-link">
  vuepress
</a></li><li class="dropdown-item"><!----> <a href="https://www.vue.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/changeLog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  changeLog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>高级</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-press/guide/Apache Dubbo Zookeeper.html" class="sidebar-link">Apache Dubbo Zookeeper</a></li><li><a href="/vue-press/guide/Apache Shiro.html" class="sidebar-link">Apache Shiro</a></li><li><a href="/vue-press/guide/Hibernate.html" class="sidebar-link">Hibernate</a></li><li><a href="/vue-press/guide/JDBCTemplate.html" class="sidebar-link">JDBCTemplate</a></li><li><a href="/vue-press/guide/JPA.html" class="sidebar-link">JPA</a></li><li><a href="/vue-press/guide/Mybatis.html" class="sidebar-link">Mybatis</a></li><li><a href="/vue-press/guide/Mysql比知必会.html" class="sidebar-link">Mysql必知必会</a></li><li><a href="/vue-press/guide/Redis.html" class="sidebar-link">Redis</a></li><li><a href="/vue-press/guide/Spring.html" class="sidebar-link">Spring</a></li><li><a href="/vue-press/guide/Spring Boot.html" class="sidebar-link">Spring Boot</a></li><li><a href="/vue-press/guide/Spring Boot整合其他组件.html" class="sidebar-link">Spring Boot整合其他组件</a></li><li><a href="/vue-press/guide/Spring Cloud.html" class="sidebar-link">Spring Cloud Netfilx</a></li><li><a href="/vue-press/guide/Spring Cloud Alibaba.html" class="sidebar-link">Spring Cloud Alibaba</a></li><li><a href="/vue-press/guide/Spring Cloud Stream.html" class="sidebar-link">Spring Cloud Stream</a></li><li><a href="/vue-press/guide/Spring Data.html" class="sidebar-link">Spring Data</a></li><li><a href="/vue-press/guide/Spring MVC.html" class="sidebar-link">Spring MVC</a></li><li><a href="/vue-press/guide/Spring Security.html" class="sidebar-link">Spring Security</a></li><li><a href="/vue-press/guide/Spring 注解.html" class="active sidebar-link">Spring注解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#spring注解" class="sidebar-link">Spring注解：</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#组件的添加" class="sidebar-link">组件的添加：</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#bean生命周期" class="sidebar-link" style="padding-left:3rem;">Bean生命周期</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#bean创建" class="sidebar-link" style="padding-left:4rem;">Bean创建</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#bean初始化" class="sidebar-link" style="padding-left:4rem;">Bean初始化：</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#bean销毁" class="sidebar-link" style="padding-left:4rem;">Bean销毁：</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#bean初始化方式" class="sidebar-link" style="padding-left:3rem;">Bean初始化方式</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#指定初始化和销毁方法" class="sidebar-link" style="padding-left:4rem;">指定初始化和销毁方法</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#通过让bean实现initializingbean-定义初始化逻辑-disposablebean-定义销毁逻辑" class="sidebar-link" style="padding-left:4rem;">通过让Bean实现InitializingBean（定义初始化逻辑），DisposableBean（定义销毁逻辑）</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#可以使用jsr250" class="sidebar-link" style="padding-left:4rem;">可以使用JSR250：</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#beanpostprocessor【interface】-bean的后置处理器" class="sidebar-link" style="padding-left:4rem;">BeanPostProcessor【interface】：bean的后置处理器</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#组件赋值" class="sidebar-link">组件赋值：</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#自动装配" class="sidebar-link" style="padding-left:3rem;">自动装配：</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#autowired-spring定义的注解" class="sidebar-link" style="padding-left:4rem;">@Autowired(Spring定义的注解)</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#autowired所在的位置" class="sidebar-link" style="padding-left:5rem;">@Autowired所在的位置</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#spring还支持使用-resource-jsr250-和-inject-jsr330-java规范的注解" class="sidebar-link" style="padding-left:4rem;">Spring还支持使用@Resource(JSR250)和@Inject(JSR330)[java规范的注解]</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#自定义组件使用spring容器的一些组件" class="sidebar-link" style="padding-left:4rem;">自定义组件使用Spring容器的一些组件</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#读取外部配置文件-propertysource" class="sidebar-link" style="padding-left:3rem;">读取外部配置文件@PropertySource</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#动态激活环境-profile" class="sidebar-link" style="padding-left:3rem;">动态激活环境@Profile</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#组件注入" class="sidebar-link">组件注入：</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#方法参数" class="sidebar-link" style="padding-left:3rem;">方法参数</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#构造器" class="sidebar-link" style="padding-left:3rem;">构造器</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#applicationcontextaware" class="sidebar-link" style="padding-left:3rem;">ApplicationContextAware</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#aop" class="sidebar-link">Aop:</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#基于注解版实现aop" class="sidebar-link" style="padding-left:3rem;">基于注解版实现AOP</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#基于注解的aop原理" class="sidebar-link" style="padding-left:3rem;">基于注解的AOP原理</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#enableaspectjautoproxy" class="sidebar-link" style="padding-left:4rem;">@EnableAspectJAutoProxy</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#aspectjautoproxyregistrar" class="sidebar-link" style="padding-left:4rem;">AspectJAutoProxyRegistrar</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#annotationawareaspectjautoproxycreator" class="sidebar-link" style="padding-left:4rem;">AnnotationAwareAspectJAutoProxyCreator</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#声明式事务" class="sidebar-link">声明式事务：</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#扩展原理" class="sidebar-link">扩展原理</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#beanfactorypostprocessor" class="sidebar-link" style="padding-left:3rem;">BeanFactoryPostProcessor</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#beanfactorypostprocessor原理" class="sidebar-link" style="padding-left:4rem;">BeanFactoryPostProcessor原理</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#beandefinitionregisterpostprocessor" class="sidebar-link" style="padding-left:3rem;">BeanDefinitionRegisterPostProcessor</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#beandefinitionregisterpostprocessor原理" class="sidebar-link" style="padding-left:4rem;">BeanDefinitionRegisterPostProcessor原理</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#applicationlistener" class="sidebar-link" style="padding-left:3rem;">ApplicationListener</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#applicationlistener的原理" class="sidebar-link" style="padding-left:4rem;">ApplicationListener的原理</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#spring容器创建过程" class="sidebar-link" style="padding-left:3rem;">Spring容器创建过程</a></li><li class="sidebar-sub-header"><a href="/vue-press/guide/Spring 注解.html#springmvc注解" class="sidebar-link">SpringMVC注解：</a></li></ul></li></ul></li><li><a href="/vue-press/guide/tkmybatis.html" class="sidebar-link">tkmybatis</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发记录问题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>持续集成</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目篇</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="spring注解"><a href="#spring注解" class="header-anchor">#</a> Spring注解：</h2> <p>在说spring注解时我们先看下什么是JAVA注解：Annotation(注解)是JDK1.5及以后版本引入的。它可以用于创建文档，跟踪代码中的依赖性，甚至执行基本编译时检查。注解是以‘@注解名’在代码中存在的，根据注解参数的个数，我们可以将注解分为<code>：标记注解、单值注解、完整注解</code>三类。它们都不会直接影响到程序的语义，只是作为注解（标识）存在，我们可以通过反射机制编程实现对这些元数据（用来描述数据的数据）的访问。</p> <p>AnnotationConfigApplicationContext:是一个用来管理注解bean的容器</p> <h3 id="组件的添加"><a href="#组件的添加" class="header-anchor">#</a> 组件的添加：</h3> <p><img alt="" data-src="https://mmbiz.qpic.cn/mmbiz_png/B77kSvewKqXRz1TazsVnVfXHaEO0ETqV9xyJUSPnRARAy8Eic9qHCXFwmFLptWzpQQg6HNWpffLFnibIJZuMmm8A/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" loading="lazy" class="lazy"></p> <p><code>@Configuration</code>:告诉spring这是个配置类（等同于配置文件）</p> <p><code>@ComponentScan</code>:指定扫描的包</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ComponentScans</span><span class="token punctuation">(</span>
        value <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;com.atguigu&quot;</span><span class="token punctuation">,</span> 
                        includeFilters <span class="token operator">=</span> <span class="token punctuation">{</span>
                                <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token class-name">FilterType</span><span class="token punctuation">.</span>ANNOTATION<span class="token punctuation">,</span>classes<span class="token operator">=</span><span class="token punctuation">{</span><span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                                <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token class-name">FilterType</span><span class="token punctuation">.</span>ASSIGNABLE_TYPE<span class="token punctuation">,</span>classes<span class="token operator">=</span><span class="token punctuation">{</span><span class="token class-name">BookService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token class-name">FilterType</span><span class="token punctuation">.</span>CUSTOM<span class="token punctuation">,</span>classes<span class="token operator">=</span><span class="token punctuation">{</span><span class="token class-name">MyTypeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>useDefaultFilters <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token comment">//@ComponentScan  value:指定要扫描的包</span>
<span class="token comment">//excludeFilters = Filter[] ：指定扫描的时候按照什么规则排除那些组件</span>
<span class="token comment">//includeFilters = Filter[] ：指定扫描的时候只需要包含哪些组件</span>
<span class="token comment">//FilterType.ANNOTATION：按照注解</span>
<span class="token comment">//FilterType.ASSIGNABLE_TYPE：按照给定的类型；</span>
<span class="token comment">//FilterType.ASPECTJ：使用ASPECTJ表达式</span>
<span class="token comment">//FilterType.REGEX：使用正则指定</span>
<span class="token comment">//FilterType.CUSTOM：使用自定义规则</span>
</code></pre></div><p><code>@Bean</code>:给容器中注册一个Bean;类型为返回值的类型，id默认是用方法名作为id</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">person01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Bill Gates&quot;</span><span class="token punctuation">,</span><span class="token number">62</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>@Component</code>:默认加在ioc容器中的组件，容器启动会调用无参构造器创建对象，再进行初始化赋值等操作</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
	
	<span class="token keyword">public</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;car constructor...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;car ... init...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">detory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;car ... detory...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p><code>@Controller</code>: 声明是一个控制层 名字默认是类名首字母小写</p> <p><code>@Service</code>：声明是service层 名字默认是类名首字母小写 其中自己可以改变这个实例名字：</p> <p><code>@Repository</code>：声明是dao层。名字默认是类名首字母小写 同样可以自己手动书写实例名称</p> <p><code>@Conditional</code>: 按照一定的条件进行判断，满足条件给容器中注册bean</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
* @Conditional({Condition}) ： 按照一定的条件进行判断，满足条件给容器中注册bean
* 如果系统是windows，给容器中注册(&quot;bill&quot;)
* 如果是linux系统，给容器中注册(&quot;linus&quot;)
*/</span>
<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;bill&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">person01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Bill Gates&quot;</span><span class="token punctuation">,</span><span class="token number">62</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">LinuxCondition</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;linus&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">person02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;linus&quot;</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//LinuxCondition类。判断是否linux系统</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinuxCondition</span> <span class="token keyword">implements</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>

	<span class="token comment">/**
	 * ConditionContext：判断条件能使用的上下文（环境）
	 * AnnotatedTypeMetadata：注释信息
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> context<span class="token punctuation">,</span> <span class="token class-name">AnnotatedTypeMetadata</span> metadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO是否linux系统</span>
		<span class="token comment">//1、能获取到ioc使用的beanfactory</span>
		<span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//2、获取类加载器</span>
		<span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//3、获取当前环境信息</span>
		<span class="token class-name">Environment</span> environment <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//4、获取到bean定义的注册类</span>
		<span class="token class-name">BeanDefinitionRegistry</span> registry <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token class-name">String</span> property <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;os.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">//可以判断容器中的bean注册情况，也可以给容器中注册bean</span>
		<span class="token keyword">boolean</span> definition <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>property<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;linux&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p><code>@Primary</code>: 让Spring进行自动装配的时候，默认使用首选的bean；也可以继续使用 <code>@Qualifier</code>指定需要装配的bean的名字</p> <p><code>@Lazy</code>：懒加载：</p> <ul><li>单实例bean：默认在容器启动的时候创建对象；</li> <li>懒加载：容器启动不创建对象。第一次使用(获取)Bean创建对象，并初始化；</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Lazy</span>
<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;给容器中添加Person....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>@Scope</code> :设置作用域。默认为单例模式</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * ConfigurableBeanFactory#SCOPE_PROTOTYPE
 * @see ConfigurableBeanFactory#SCOPE_SINGLETON
 * @see org.springframework.web.context.WebApplicationContext#SCOPE_REQUEST  request
 * @see org.springframework.web.context.WebApplicationContext#SCOPE_SESSION     sesssion
 * 
 * @Scope:调整作用域 
 *参数：
 * singleton：单实例的（默认值）：ioc容器启动会调用方法创建对象放到ioc容器中。
 *            以后每次获取就是直接从容器（map.get()）中拿，
 * prototype：多实例的：ioc容器启动并不会去调用方法创建对象放在容器中。每次获取的时候才会调用方法创建对象；
 * 
 * request：同一次请求创建一个实例
 * session：同一个session创建一个实例
 * application:全局web应用级别的信作用域。
 */</span>
</code></pre></div><p><code>@Import</code>:要导入到容器的组件,容器中就会自动的注册这个组件，id默认是全类名</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 使用import进行导入Color类</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">Red</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//@Import导入组件，id默认是组件的全类名</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig2</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p><strong>给容器中注册组件的方式：</strong></p> <ol><li><p>包扫描+组件标注注解（@Controller/@Service/@Repository/@Component）[自己写的类]</p></li> <li><p>@Bean[导入的第三方包里面的组件]</p></li> <li><p>@Import[快速给容器中导入一个组件]</p> <ol><li><p>@Import(要导入到容器中的组件)；容器中就会自动注册这个组件，id默认是全类名</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 使用import进行导入Color类</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">Red</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">MyImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">MyImportBeanDefinitionRegistrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//@Import导入组件，id默认是组件的全类名</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig2</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

</code></pre></div></li> <li><p>实现ImportSelector:返回需要导入的组件的全类名数组；实现IportSelector接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//自定义逻辑返回需要导入的组件</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyImportSelector</span> <span class="token keyword">implements</span> <span class="token class-name">ImportSelector</span> <span class="token punctuation">{</span>

	<span class="token comment">//返回值，就是到导入到容器中的组件全类名</span>
	<span class="token comment">//AnnotationMetadata:当前标注@Import注解的类的所有注解信息</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token comment">//importingClassMetadata</span>
		<span class="token comment">//方法不要返回null值</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;com.atguigu.bean.Blue&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;com.atguigu.bean.Yellow&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token comment">// 然后在配置类中通过@Import进行注入</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">Red</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">MyImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">MyImportBeanDefinitionRegistrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//@Import导入组件，id默认是组件的全类名</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig2</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div></li> <li><p>实现ImportBeanDefinitionRegistrar:手动注册bean到容器中</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyImportBeanDefinitionRegistrar</span> <span class="token keyword">implements</span> <span class="token class-name">ImportBeanDefinitionRegistrar</span> <span class="token punctuation">{</span>

	<span class="token comment">/**
	 * AnnotationMetadata：当前类的注解信息
	 * BeanDefinitionRegistry:BeanDefinition注册类；
	 * 		把所有需要添加到容器中的bean；调用
	 * 		BeanDefinitionRegistry.registerBeanDefinition手工注册进来
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		
		<span class="token keyword">boolean</span> definition <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.bean.Red&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">boolean</span> definition2 <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.bean.Blue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>definition <span class="token operator">&amp;&amp;</span> definition2<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">//指定Bean定义信息；（Bean的类型，Bean。。。）</span>
			<span class="token class-name">RootBeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">RainBow</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//注册一个Bean，指定bean名</span>
			registry<span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token string">&quot;rainBow&quot;</span><span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token comment">// 使用</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">Red</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">MyImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">MyImportBeanDefinitionRegistrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//@Import导入组件，id默认是组件的全类名</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfig2</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div></li></ol></li> <li><p>使用Spring提供的 FactoryBean（工厂Bean）</p> <ol><li><p>默认获取到的是工厂bean调用getObject创建的对象</p></li> <li><p>要获取工厂Bean本身，我们需要给id前面加一个&amp;。&amp;colorFactoryBean</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//创建一个Spring定义的FactoryBean</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ColorFactoryBean</span> <span class="token keyword">implements</span> <span class="token class-name">FactoryBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Color</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

	<span class="token comment">//返回一个Color对象，这个对象会添加到容器中</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Color</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ColorFactoryBean...getObject...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getObjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token keyword">return</span> <span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//是单例？</span>
	<span class="token comment">//true：这个bean是单实例，在容器中保存一份</span>
	<span class="token comment">//false：多实例，每次获取都会创建一个新的bean；</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token comment">// 在配置类中进行获取</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ColorFactoryBean</span> <span class="token function">colorFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ColorFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IOCTest</span> <span class="token punctuation">{</span>
	<span class="token class-name">AnnotationConfigApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">MainConfig2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	
	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testImport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">printBeans</span><span class="token punctuation">(</span>applicationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Blue</span> bean <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">Blue</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">//工厂Bean获取的是调用getObject创建的对象</span>
		<span class="token class-name">Object</span> bean2 <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;colorFactoryBean&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Object</span> bean3 <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;colorFactoryBean&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;bean的类型：&quot;</span><span class="token operator">+</span>bean2<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取的是color</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;bean的类型：&quot;</span><span class="token operator">+</span>bean3<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取的是color</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bean2 <span class="token operator">==</span> bean3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// false</span>

		<span class="token comment">// 通过&amp;id前缀是获取的工厂bean的本身</span>
		<span class="token class-name">Object</span> bean4 <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;&amp;colorFactoryBean&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bean4<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// colorFactoryBean</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">printBeans</span><span class="token punctuation">(</span><span class="token class-name">AnnotationConfigApplicationContext</span> applicationContext<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> definitionNames <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBeanDefinitionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> name <span class="token operator">:</span> definitionNames<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div></li></ol></li></ol> <h4 id="bean生命周期"><a href="#bean生命周期" class="header-anchor">#</a> Bean生命周期</h4> <p>bean创建---初始化----销毁的过程</p> <p>容器管理bean的生命周期；我们可以自定义初始化和销毁方法；容器在bean进行到当前生命周期的时候来调用我们自定义的初始化和销毁方法</p> <h5 id="bean创建"><a href="#bean创建" class="header-anchor">#</a> Bean创建</h5> <p>单实例(@Scope(&quot;singleton&quot;))：在容器启动的时候创建对象</p> <p>多实例(@Scope(&quot;prototype&quot;))：在每次获取的时候创建对象</p> <h5 id="bean初始化"><a href="#bean初始化" class="header-anchor">#</a> Bean初始化：</h5> <p><strong>bean初始化前调用进行额外操作：BeanPostProcessor.postProcessBeforeInitialization</strong></p> <p>对象创建完成，并赋值后，调用bean的初始化方法</p> <p><strong>bean初始化后调用进行额外操作：BeanPostProcessor.postProcessAfterInitialization</strong></p> <blockquote><p>BeanPostProcessor原理
遍历得到容器中所有的BeanPostProcessor；挨个执行beforeInitialization，一但返回null，跳出for循环，不会执行后面的BeanPostProcessor.postProcessorsBeforeInitialization.</p></blockquote> <blockquote><p>populateBean(beanName, mbd, instanceWrapper);给bean进行属性赋值
initializeBean {
applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);// 应用所有的beforeInilization;
invokeInitMethods(beanName, wrappedBean, mbd);执行自定义初始化 	
// 应用所有的afterInilization;
applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);<br>
}</p></blockquote> <h5 id="bean销毁"><a href="#bean销毁" class="header-anchor">#</a> Bean销毁：</h5> <p>单实例(@Scope(&quot;singleton&quot;))：容器关闭的时候</p> <p>多实例(@Scope(&quot;prototype&quot;))：容器不会管理这个bean；容器不会调用销毁方法</p> <h4 id="bean初始化方式"><a href="#bean初始化方式" class="header-anchor">#</a> Bean初始化方式</h4> <h5 id="指定初始化和销毁方法"><a href="#指定初始化和销毁方法" class="header-anchor">#</a> 指定初始化和销毁方法</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.bean&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfigOfLifeCycle</span> <span class="token punctuation">{</span>
	
	<span class="token comment">//@Scope(&quot;prototype&quot;)</span>
	<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>initMethod<span class="token operator">=</span><span class="token string">&quot;init&quot;</span><span class="token punctuation">,</span>destroyMethod<span class="token operator">=</span><span class="token string">&quot;detory&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">Car</span> <span class="token function">car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
	
	<span class="token keyword">public</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;car constructor...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;car ... init...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">detory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;car ... detory...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h5 id="通过让bean实现initializingbean-定义初始化逻辑-disposablebean-定义销毁逻辑"><a href="#通过让bean实现initializingbean-定义初始化逻辑-disposablebean-定义销毁逻辑" class="header-anchor">#</a> 通过让Bean实现InitializingBean（定义初始化逻辑），DisposableBean（定义销毁逻辑）</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">implements</span> <span class="token class-name">InitializingBean</span><span class="token punctuation">,</span><span class="token class-name">DisposableBean</span> <span class="token punctuation">{</span>
	
	<span class="token keyword">public</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;cat constructor...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;cat...destroy...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;cat...afterPropertiesSet...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h5 id="可以使用jsr250"><a href="#可以使用jsr250" class="header-anchor">#</a> 可以使用JSR250：</h5> <ul><li>@PostConstruct：在bean创建完成并且属性赋值完成；来执行初始化方法</li> <li>@PreDestroy：在容器销毁bean之前通知我们进行清理工作</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 通过ApplicationContextAware创建ioc容器。这个就是beanPostProcessorAware进行操作的。</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextAware</span> <span class="token punctuation">{</span>
	
	<span class="token comment">//@Autowired</span>
	<span class="token keyword">private</span> <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;dog constructor...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//对象创建并赋值之后调用</span>
	<span class="token annotation punctuation">@PostConstruct</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Dog....@PostConstruct...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//容器移除对象之前</span>
	<span class="token annotation punctuation">@PreDestroy</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">detory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Dog....@PreDestroy...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext <span class="token operator">=</span> applicationContext<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 通过配置类进行扫描到@Component然后进行注入</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.bean&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfigOfLifeCycle</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h5 id="beanpostprocessor【interface】-bean的后置处理器"><a href="#beanpostprocessor【interface】-bean的后置处理器" class="header-anchor">#</a> BeanPostProcessor【interface】：bean的后置处理器</h5> <p>在bean初始化前后进行一些处理工作    postProcessBeforeInitialization:在初始化之前工作    postProcessAfterInitialization:在初始化之后工作</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 后置处理器：初始化前后进行处理工作
 * 将后置处理器加入到容器中
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBeanPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;postProcessBeforeInitialization...&quot;</span><span class="token operator">+</span>beanName<span class="token operator">+</span><span class="token string">&quot;=&gt;&quot;</span><span class="token operator">+</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> bean<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;postProcessAfterInitialization...&quot;</span><span class="token operator">+</span>beanName<span class="token operator">+</span><span class="token string">&quot;=&gt;&quot;</span><span class="token operator">+</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> bean<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h3 id="组件赋值"><a href="#组件赋值" class="header-anchor">#</a> 组件赋值：</h3> <p><img alt="" data-src="https://mmbiz.qpic.cn/mmbiz_png/B77kSvewKqXRz1TazsVnVfXHaEO0ETqV4tGYkQlibOBWjcxkOzRh1tHibVmJwVXmyib36jJ1aquZz0j09oZSkNJYQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" loading="lazy" class="lazy"></p> <p><code>@Value</code>: @Value赋值；</p> <ol><li>基本数值</li> <li>可以写SPEL:#{}</li> <li>可以写${}；取出配置文件【properties】中的值（在运行环境变量里面的值）</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 基本数值</span>
<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token comment">// 可以写SPEL:#{}</span>
<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;#{20-2}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
<span class="token comment">// 可以写${}；取出配置文件【properties】中的值（在运行环境变量里面的值）</span>
<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${person.nickName}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> nickName<span class="token punctuation">;</span>
</code></pre></div><h4 id="自动装配"><a href="#自动装配" class="header-anchor">#</a> 自动装配：</h4> <h5 id="autowired-spring定义的注解"><a href="#autowired-spring定义的注解" class="header-anchor">#</a> @Autowired(Spring定义的注解)</h5> <p><code>@Autowired</code> ：通过匹配<code>数据类型</code>自动装配 默认为 <code>byType</code>方式；标注在方法，Spring容器创建当前对象，就会调用方法，完成赋值；方法使用的参数，自定义类型的值从ioc容器中获取。</p> <ol><li><p>默认优先按照类型去容器中找对应的组件:applicationContext.getBean(BookDao.class);找到就赋值</p></li> <li><p>如果找到多个相同类型的组件，再将属性的名称作为组件的id去容器中查找applicationContext.getBean(&quot;bookDao&quot;)</p></li> <li><p><code>@Qualifier(&quot;bookDao&quot;)</code>：使用@Qualifier指定需要装配的组件的id，而不是使用属性名</p></li> <li><p>自动装配默认一定要将属性赋值好，没有就会报错；可以使用@Autowired(required=false);</p></li> <li><p><code>@Primary</code>：让Spring进行自动装配的时候，默认使用首选的bean；也可以继续使用<code>@Qualifier</code>指定需要装配的bean的名字</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">BookService</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">BookDao</span>  bookDao<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h6 id="autowired所在的位置"><a href="#autowired所在的位置" class="header-anchor">#</a> @Autowired所在的位置</h6> <p>@Autowired:可标注：构造器，参数，方法，属性；都是从容器中获取参数组件的值</p> <ol><li><p>[标注在方法位置]：@Bean+方法参数；参数从容器中获取;默认不写@Autowired效果是一样的；都能自动装配</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//标注在方法，Spring容器创建当前对象，就会调用方法，完成赋值；</span>
<span class="token comment">//方法使用的参数，自定义类型的值从ioc容器中获取</span>
<span class="token annotation punctuation">@Autowired</span> 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCar</span><span class="token punctuation">(</span><span class="token class-name">Car</span> car<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>car <span class="token operator">=</span> car<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>[标在构造器上]：如果组件只有一个有参构造器，这个有参构造器的@Autowired可以省略，参数位置的组件还是可以自动从容器中获取</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//构造器要用的组件，都是从容器中获取</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">public</span> <span class="token class-name">Boss</span><span class="token punctuation">(</span><span class="token class-name">Car</span> car<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>car <span class="token operator">=</span> car<span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Boss...有参构造器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>放在参数位置：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCar</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">Car</span> car<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>car <span class="token operator">=</span> car<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h5 id="spring还支持使用-resource-jsr250-和-inject-jsr330-java规范的注解"><a href="#spring还支持使用-resource-jsr250-和-inject-jsr330-java规范的注解" class="header-anchor">#</a> Spring还支持使用@Resource(JSR250)和@Inject(JSR330)[java规范的注解]</h5> <p><code>@Resources:</code>可以和@<code>Autowired</code>一样实现自动装配功能；默认是按照<code>组件名称</code>进行装配的 <code>byName</code>； 没有能支持@Primary功能没有支持@Autowired（reqiured=false）;</p> <p><code>@Inject：</code>需要导入javax.inject的包，和Autowired的功能一样。没有required=false的功能；</p> <h5 id="自定义组件使用spring容器的一些组件"><a href="#自定义组件使用spring容器的一些组件" class="header-anchor">#</a> 自定义组件使用Spring容器的一些组件</h5> <p>自定义组件实现xxxAware；在创建对象的时候，会调用接口规定的方法注入相关组件；Aware；</p> <p>把Spring底层一些组件注入到自定义的Bean中；  都是使用的后置处理器进行注入的。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Red</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextAware</span><span class="token punctuation">,</span><span class="token class-name">BeanNameAware</span><span class="token punctuation">,</span><span class="token class-name">EmbeddedValueResolverAware</span> <span class="token punctuation">{</span>
	
	<span class="token keyword">private</span> <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;传入的ioc：&quot;</span><span class="token operator">+</span>applicationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext <span class="token operator">=</span> applicationContext<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前bean的名字：&quot;</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEmbeddedValueResolver</span><span class="token punctuation">(</span><span class="token class-name">StringValueResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token class-name">String</span> resolveStringValue <span class="token operator">=</span> resolver<span class="token punctuation">.</span><span class="token function">resolveStringValue</span><span class="token punctuation">(</span><span class="token string">&quot;你好 ${os.name} 我是 #{20*18}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;解析的字符串：&quot;</span><span class="token operator">+</span>resolveStringValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h4 id="读取外部配置文件-propertysource"><a href="#读取外部配置文件-propertysource" class="header-anchor">#</a> 读取外部配置文件@PropertySource</h4> <p><code>@PropertySource：</code>读取外部配置文件中的k/v保存到运行的环境变量中;加载完外部的配置文件以后使用${}取出配置文件的值<code>@PropertySource(value{&quot;classpath:/person.properties&quot;})</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//使用@PropertySource读取外部配置文件中的k/v保存到运行的环境变量中;加载完外部的配置文件以后使用${}取出配置文件的值</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;classpath:/person.properties&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfigOfPropertyValues</span> <span class="token punctuation">{</span>
	
	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p><code>@PropertySources</code>:读取多个propertySource</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@PropertySources</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:person.properties&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
				   <span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:database.properties&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="动态激活环境-profile"><a href="#动态激活环境-profile" class="header-anchor">#</a> 动态激活环境@Profile</h4> <p><code>@Profile：</code>指定组件在哪个环境的情况下才能被注册到容器中，不指定，任何环境下都能注册这个组件</p> <ol><li>加了环境标识的bean，只有这个环境被激活的时候才能注册到容器中。默认是default环境</li> <li>写在配置类上，只有是指定的环境的时候，整个配置类里面的所有配置才能开始生效</li> <li>没有标注环境标识的bean在，任何环境下都是加载的；</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * Profile：
 * 		Spring为我们提供的可以根据当前环境，动态的激活和切换一系列组件的功能；
 * 
 * 开发环境、测试环境、生产环境；
 * 数据源：(/A)(/B)(/C)；
 * 
 * 
 * @Profile：指定组件在哪个环境的情况下才能被注册到容器中，不指定，任何环境下都能注册这个组件
 * 
 * 1）、加了环境标识的bean，只有这个环境被激活的时候才能注册到容器中。默认是default环境
 * 2）、写在配置类上，只有是指定的环境的时候，整个配置类里面的所有配置才能开始生效
 * 3）、没有标注环境标识的bean在，任何环境下都是加载的；
 */</span>

<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:/dbconfig.properties&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfigOfProfile</span> <span class="token keyword">implements</span> <span class="token class-name">EmbeddedValueResolverAware</span><span class="token punctuation">{</span>
	
	<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${db.user}&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> user<span class="token punctuation">;</span>
	
	<span class="token keyword">private</span> <span class="token class-name">StringValueResolver</span> valueResolver<span class="token punctuation">;</span>
	
	<span class="token keyword">private</span> <span class="token class-name">String</span>  driverClass<span class="token punctuation">;</span>
	
	
	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">Yellow</span> <span class="token function">yellow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Yellow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;testDataSource&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSourceTest</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${db.password}&quot;</span><span class="token punctuation">)</span><span class="token class-name">String</span> pwd<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
		<span class="token class-name">ComboPooledDataSource</span> dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComboPooledDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		dataSource<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
		dataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
		dataSource<span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://localhost:3306/test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		dataSource<span class="token punctuation">.</span><span class="token function">setDriverClass</span><span class="token punctuation">(</span>driverClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	
	<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;dev&quot;</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;devDataSource&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSourceDev</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${db.password}&quot;</span><span class="token punctuation">)</span><span class="token class-name">String</span> pwd<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
		<span class="token class-name">ComboPooledDataSource</span> dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComboPooledDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		dataSource<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
		dataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
		dataSource<span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://localhost:3306/ssm_crud&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		dataSource<span class="token punctuation">.</span><span class="token function">setDriverClass</span><span class="token punctuation">(</span>driverClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;prod&quot;</span><span class="token punctuation">)</span>
	<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;prodDataSource&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSourceProd</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${db.password}&quot;</span><span class="token punctuation">)</span><span class="token class-name">String</span> pwd<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
		<span class="token class-name">ComboPooledDataSource</span> dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComboPooledDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		dataSource<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
		dataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
		dataSource<span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://localhost:3306/scw_0515&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		dataSource<span class="token punctuation">.</span><span class="token function">setDriverClass</span><span class="token punctuation">(</span>driverClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEmbeddedValueResolver</span><span class="token punctuation">(</span><span class="token class-name">StringValueResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>valueResolver <span class="token operator">=</span> resolver<span class="token punctuation">;</span>
		driverClass <span class="token operator">=</span> valueResolver<span class="token punctuation">.</span><span class="token function">resolveStringValue</span><span class="token punctuation">(</span><span class="token string">&quot;${db.driverClass}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token comment">//// 测试</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IOCTest_Profile</span> <span class="token punctuation">{</span>
	
	<span class="token comment">//1、使用命令行动态参数: 在虚拟机参数位置加载 -Dspring.profiles.active=test</span>
	<span class="token comment">//2、代码的方式激活某种环境；</span>
	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">AnnotationConfigApplicationContext</span> applicationContext <span class="token operator">=</span> 
				<span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//1、创建一个applicationContext</span>
		<span class="token comment">//2、设置需要激活的环境</span>
		applicationContext<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setActiveProfiles</span><span class="token punctuation">(</span><span class="token string">&quot;dev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//3、注册主配置类</span>
		applicationContext<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">MainConfigOfProfile</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//4、启动刷新容器</span>
		applicationContext<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		
		<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> namesForType <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBeanNamesForType</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> string <span class="token operator">:</span> namesForType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token class-name">Yellow</span> bean <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">Yellow</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
		applicationContext<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="组件注入"><a href="#组件注入" class="header-anchor">#</a> 组件注入：</h3> <p><img alt="" data-src="https://mmbiz.qpic.cn/mmbiz_png/B77kSvewKqXRz1TazsVnVfXHaEO0ETqVSKiatlgs1a0tQtbAqTQkEAPYZYCv2dicYARkaImlJ7h3gRMp83EzoAFA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" loading="lazy" class="lazy"></p> <h4 id="方法参数"><a href="#方法参数" class="header-anchor">#</a> 方法参数</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//标注在方法，Spring容器创建当前对象，就会调用方法，完成赋值；</span>
<span class="token comment">//方法使用的参数，自定义类型的值从ioc容器中获取</span>
<span class="token annotation punctuation">@Autowired</span> 
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCar</span><span class="token punctuation">(</span><span class="token class-name">Car</span> car<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>car <span class="token operator">=</span> car<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="构造器"><a href="#构造器" class="header-anchor">#</a> 构造器</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">public</span> <span class="token class-name">Boss</span><span class="token punctuation">(</span><span class="token class-name">Car</span> car<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>car <span class="token operator">=</span> car<span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Boss...有参构造器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="applicationcontextaware"><a href="#applicationcontextaware" class="header-anchor">#</a> ApplicationContextAware</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Red</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextAware</span><span class="token punctuation">,</span><span class="token class-name">BeanNameAware</span><span class="token punctuation">,</span><span class="token class-name">EmbeddedValueResolverAware</span> <span class="token punctuation">{</span>
	
	<span class="token keyword">private</span> <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;传入的ioc：&quot;</span><span class="token operator">+</span>applicationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext <span class="token operator">=</span> applicationContext<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前bean的名字：&quot;</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEmbeddedValueResolver</span><span class="token punctuation">(</span><span class="token class-name">StringValueResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token class-name">String</span> resolveStringValue <span class="token operator">=</span> resolver<span class="token punctuation">.</span><span class="token function">resolveStringValue</span><span class="token punctuation">(</span><span class="token string">&quot;你好 ${os.name} 我是 #{20*18}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;解析的字符串：&quot;</span><span class="token operator">+</span>resolveStringValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h3 id="aop"><a href="#aop" class="header-anchor">#</a> Aop:</h3> <p><img alt="" data-src="https://mmbiz.qpic.cn/mmbiz_png/B77kSvewKqXRz1TazsVnVfXHaEO0ETqVibfY9TS7UxDiad6krBJ6sHE7kH8CicALibrykUIPU4qFzcqscBp83Csd5g/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" loading="lazy" class="lazy"></p> <p><code>@EnableAspectJAutoProxy：</code>开启AOP功能会给容器中注册AnnotationAwareAspectJAutoProxyCreator组件AnnotationAwareAspectJAutoProxyCreator是一个后置处理器；</p> <p><code>@Before/@Aftert/@AfterReturning/@AfterThrowing/@Around</code></p> <blockquote><p>前置通知(@Before)：logStart：在目标方法(div)运行之前运行</p> <p>后置通知(@After)：logEnd：在目标方法(div)运行结束之后运行（无论方法正常结束还是异常结束）</p> <p>返回通知(@AfterReturning)：logReturn：在目标方法(div)正常返回之后运行</p> <p>异常通知(@AfterThrowing)：logException：在目标方法(div)出现异常以后运行</p> <p>环绕通知(@Around)：动态代理，手动推进目标方法运行（joinPoint.procced()）</p></blockquote> <p><code>@Pointcut</code>：切点</p> <h4 id="基于注解版实现aop"><a href="#基于注解版实现aop" class="header-anchor">#</a> 基于注解版实现AOP</h4> <p>Aop 指在程序运行期间动态的将某段代码切入到指定方法指定位置进行运行的编程方式；</p> <ol><li><p>导入aop模块；Spring AOP：(spring-aspects)</p></li> <li><p>定义一个业务逻辑类（MathCalculator）；在业务逻辑运行的时候将日志进行打印（方法之前、方法运行结束、方法出现异常，xxx）</p></li> <li><p>定义一个日志切面类（LogAspects）：切面类里面的方法需要动态感知MathCalculator.div运行到哪里然后执行；</p></li> <li><p>给切面类的目标方法标注何时何地运行（通知注解）；</p></li> <li><p>将切面类和业务逻辑类（目标方法所在类）都加入到容器中;</p></li> <li><p>必须告诉Spring哪个类是切面类(给切面类上加一个注解：@Aspect)</p></li> <li><p>给配置类中加 @EnableAspectJAutoProxy 【开启基于注解的aop模式】</p></li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableAspectJAutoProxy</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainConfigOfAOP</span> <span class="token punctuation">{</span>
	 
	<span class="token comment">//业务逻辑类加入容器中</span>
	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">MathCalculator</span> <span class="token function">calculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MathCalculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//切面类加入到容器中</span>
	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">LogAspects</span> <span class="token function">logAspects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LogAspects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>定义一个切面</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogAspects</span> <span class="token punctuation">{</span>
	
	<span class="token comment">//抽取公共的切入点表达式</span>
	<span class="token comment">//1、本类引用</span>
	<span class="token comment">//2、其他的切面引用</span>
	<span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(public int com.atguigu.aop.MathCalculator.*(..))&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pointCut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token comment">//@Before在目标方法之前切入；切入点表达式（指定在哪个方法切入）</span>
	<span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;pointCut()&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logStart</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token operator">+</span>joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;运行。。。@Before:参数列表是：{&quot;</span><span class="token operator">+</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.aop.LogAspects.pointCut()&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logEnd</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token operator">+</span>joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;结束。。。@After&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//JoinPoint一定要出现在参数表的第一位</span>
	<span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;pointCut()&quot;</span><span class="token punctuation">,</span>returning<span class="token operator">=</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logReturn</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span><span class="token class-name">Object</span> result<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token operator">+</span>joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;正常返回。。。@AfterReturning:运行结果：{&quot;</span><span class="token operator">+</span>result<span class="token operator">+</span><span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;pointCut()&quot;</span><span class="token punctuation">,</span>throwing<span class="token operator">=</span><span class="token string">&quot;exception&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logException</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span><span class="token class-name">Exception</span> exception<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token operator">+</span>joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;异常。。。异常信息：{&quot;</span><span class="token operator">+</span>exception<span class="token operator">+</span><span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MathCalculator</span> <span class="token punctuation">{</span>
	
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span><span class="token keyword">int</span> j<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MathCalculator...div...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> i<span class="token operator">/</span>j<span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h4 id="基于注解的aop原理"><a href="#基于注解的aop原理" class="header-anchor">#</a> 基于注解的AOP原理</h4> <p>我们先看一下关于AOP的类图：
<a href="https://imgtu.com/i/WCSJw6" target="_blank" rel="noopener noreferrer"><img alt="WCSJw6.png" data-src="https://z3.ax1x.com/2021/07/11/WCSJw6.png" loading="lazy" class="lazy"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h5 id="enableaspectjautoproxy"><a href="#enableaspectjautoproxy" class="header-anchor">#</a> @EnableAspectJAutoProxy</h5> <p>@EnableAspectJAutoProxy是开启进入AOP的代理的配置。我们可以看到在这个注解上使用@Import进行导入了</p> <p>AspectJAutoProxyRegistrar，那么我们的分析都应该从这里出发。</p> <p>@Import(AspectJAutoProxyRegistrar.class)：给容器中导入AspectJAutoProxyRegistrar</p> <p>利用AspectJAutoProxyRegistrar自定义给容器中注册bean；BeanDefinetion</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">AspectJAutoProxyRegistrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableAspectJAutoProxy</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> <span class="token function">proxyTargetClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">exposeProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="aspectjautoproxyregistrar"><a href="#aspectjautoproxyregistrar" class="header-anchor">#</a> AspectJAutoProxyRegistrar</h5> <p>根据给定的EnableAspectJAutoProxy注释，根据当前的BeanDefinitionRegistry注册AnnotationAwareAspectJAutoProxyCreator 。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">AspectJAutoProxyRegistrar</span> <span class="token keyword">implements</span> <span class="token class-name">ImportBeanDefinitionRegistrar</span> <span class="token punctuation">{</span>

	<span class="token comment">/**
	根据导入的@Configuration类上的@ EnableAspectJAutoProxy.proxyTargetClass()属性的值注册、升级和配置AspectJ 自动代理创建者
	**/</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span>
			<span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">// AopConfigutils:用于处理 AOP 自动代理创建者注册的实用程序类。只能注册一个自动代理创建者，但有多个具体实现可用。 因此这个类包装了一个简单的升级协议，允许类请求一个特定的自动代理创建者并知道该类or a subclass thereof最终将驻留在应用程序上下文中</span>
        <span class="token class-name">AopConfigUtils</span><span class="token punctuation">.</span><span class="token function">registerAspectJAnnotationAutoProxyCreatorIfNecessary</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// </span>
		<span class="token class-name">AnnotationAttributes</span> enableAspectJAutoProxy <span class="token operator">=</span>
				<span class="token class-name">AnnotationConfigUtils</span><span class="token punctuation">.</span><span class="token function">attributesFor</span><span class="token punctuation">(</span>importingClassMetadata<span class="token punctuation">,</span> <span class="token class-name">EnableAspectJAutoProxy</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>enableAspectJAutoProxy<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;proxyTargetClass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">AopConfigUtils</span><span class="token punctuation">.</span><span class="token function">forceAutoProxyCreatorToUseClassProxying</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>enableAspectJAutoProxy<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;exposeProxy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">AopConfigUtils</span><span class="token punctuation">.</span><span class="token function">forceAutoProxyCreatorToExposeProxy</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>在AopConfigUtils.registerAspectJAnnotationAutoProxyCreatorIfNecessary()这个方法中我们可以看到</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AopConfigUtils</span> <span class="token punctuation">{</span>

	<span class="token comment">/**
	 * 内部管理的自动代理创建者的 bean 名称.
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> AUTO_PROXY_CREATOR_BEAN_NAME <span class="token operator">=</span>
			<span class="token string">&quot;org.springframework.aop.config.internalAutoProxyCreator&quot;</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * 按升级顺序存储自动代理创建者类.
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> APC_PRIORITY_LIST <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Setup the escalation list.
	 */</span>
	<span class="token keyword">static</span> <span class="token punctuation">{</span>
		APC_PRIORITY_LIST<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">InfrastructureAdvisorAutoProxyCreator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		APC_PRIORITY_LIST<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">AspectJAwareAdvisorAutoProxyCreator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		APC_PRIORITY_LIST<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">AnnotationAwareAspectJAutoProxyCreator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// ... 省略</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">BeanDefinition</span> <span class="token function">registerAspectJAnnotationAutoProxyCreatorIfNecessary</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">registerAspectJAnnotationAutoProxyCreatorIfNecessary</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">BeanDefinition</span> <span class="token function">registerAspectJAnnotationAutoProxyCreatorIfNecessary</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">,</span> <span class="token class-name">Object</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">registerOrEscalateApcAsRequired</span><span class="token punctuation">(</span><span class="token class-name">AnnotationAwareAspectJAutoProxyCreator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> registry<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在这里我们可以看到注入了AnnotationAwareAspectJAutoProxyCreator(处理器)所以我们应该往下面看这个类</p> <h5 id="annotationawareaspectjautoproxycreator"><a href="#annotationawareaspectjautoproxycreator" class="header-anchor">#</a> AnnotationAwareAspectJAutoProxyCreator</h5> <p>AspectJAwareAdvisorAutoProxyCreator子类，用于处理当前应用程序上下文中的所有 AspectJ 注释方面，以及 Spring Advisor。任何带有 AspectJ 注释的类都将被自动识别，并且如果 Spring AOP 的基于代理的模型能够应用它们的建议。 这涵盖了方法执行连接点。如果使用 <a href="aop:include">aop:include</a> 元素，则只有名称与包含模式匹配的 @AspectJ bean 才会被视为定义用于 Spring 自动代理的方面.</p> <p>其实AnnotationAwareAspectJAutoProxyCreator就是一个后置处理器</p> <p>我们一直向上找AnnotationAwareAspectJAutoProxyCreator 的父类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">AnnotationAwareAspectJAutoProxyCreator</span> <span class="token keyword">extends</span> <span class="token class-name">AspectJAwareAdvisorAutoProxyCreator</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>AnnotationAwareAspectJAutoProxyCreator.initBeanFactory()</p> <p>AspectJAwareAdvisorAutoProxyCreator的父类AbstractAdvisorAutoProxyCreator</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">AspectJAwareAdvisorAutoProxyCreator</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAdvisorAutoProxyCreator</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>AbstractAdvisorAutoProxyCreator的父类：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractAdvisorAutoProxyCreator</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAutoProxyCreator</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>AbstractAdvisorAutoProxyCreator.setBeanFactory()-&gt;initBeanFactory()</p> <p>AbstractAutoProxyCreator的父类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractAutoProxyCreator</span> <span class="token keyword">extends</span> <span class="token class-name">ProxyProcessorSupport</span>
		<span class="token keyword">implements</span> <span class="token class-name">SmartInstantiationAwareBeanPostProcessor</span><span class="token punctuation">,</span> <span class="token class-name">BeanFactoryAware</span> <span class="token punctuation">{</span>
</code></pre></div><p>在AbstractAutoProxyCreator类中我们发现有setBeanFactory方法。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">BeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory <span class="token operator">=</span> beanFactory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>AnnotationAwareAspectJAutoProxyCreator创建注册的整个过程如下：</strong></p> <p>AnnotationAwareAspectJAutoProxyCreateor其实就是这个(InstantiationAwareBeanPostProcessor)类型的处理器.</p> <ol><li><p>传入配置类，创建ioc容器</p></li> <li><p>注册配置类，调用refresh（）刷新容器；</p></li> <li><p>registerBeanPostProcessors(beanFactory);注册bean的后置处理器来方便拦截bean的创建；</p> <ol><li><p>先获取ioc容器已经定义了的需要创建对象的所有BeanPostProcessor</p></li> <li><p>给容器中加别的BeanPostProcessor</p></li> <li><p>优先注册实现了PriorityOrdered接口的BeanPostProcessor；</p></li> <li><p>再给容器中注册实现了Ordered接口的BeanPostProcessor；</p></li> <li><p>注册没实现优先级接口的BeanPostProcessor；</p></li> <li><p>注册BeanPostProcessor，实际上就是创建BeanPostProcessor对象，保存在容器中；</p> <p>创建internalAutoProxyCreator的BeanPostProcessor【AnnotationAwareAspectJAutoProxyCreator</p> <ol><li>创建Bean的实例</li> <li>populateBean；给bean的各种属性赋值</li> <li>initializeBean：初始化bean；</li> <li>BeanPostProcessor(AnnotationAwareAspectJAutoProxyCreator)创建成功；--》aspectJAdvisorsBuilder
<ol><li>invokeAwareMethods()：处理Aware接口的方法回调</li> <li>applyBeanPostProcessorsBeforeInitialization()：应用后置处理器的postProcessBeforeInitialization（）</li> <li>nvokeInitMethods()；执行自定义的初始化方法</li> <li>applyBeanPostProcessorsAfterInitialization()；执行后置处理器的postProcessAfterInitialization（）；</li></ol></li></ol></li> <li><p>把BeanPostProcessor注册到BeanFactory中；        beanFactory.addBeanPostProcessor(postProcessor);</p></li></ol></li> <li><p>finishBeanFactoryInitialization(beanFactory);完成BeanFactory初始化工作；创建剩下的单实例bean</p> <ol><li><p>遍历获取容器中所有的Bean,依次创建对象，getBean(beanName);</p></li> <li><p>创建Bean</p> <ol><li><p>【AnnotationAwareAspectJAutoProxyCreator在所有bean创建之前会有一个拦截，InstantiationAwareBeanPostProcessor，会调用postProcessBeforeInstantiation()】.先从缓存中获取当前bean，如果能获取到，说明bean是之前被创建过的，直接使用，否则再创建；     只要创建好的Bean都会被缓存起来</p></li> <li><p>createBean（）;创建bean；</p> <p>AnnotationAwareAspectJAutoProxyCreator 会在任何bean创建之前先尝试返回bean的实例</p> <p>【BeanPostProcessor是在Bean对象创建完成初始化前后调用的】</p> <p>【InstantiationAwareBeanPostProcessor是在创建Bean实例之前先尝试用后置处理器返回对象的】</p> <ol><li><p>resolveBeforeInstantitation(beanName,mbdToUse);解析BeforeInstantation,希望后置处理器在此返回一个代理对象，如果能返回代理对象就使用，如果不能就继续。</p> <ol><li><p>后置处理器先尝试返回对象/</p> <div class="language-java extra-class"><pre class="language-java"><code>bean <span class="token operator">=</span> applyBeanPostProcessorsBeforeInstantiation（）：
<span class="token comment">//拿到所有后置处理器，如果是InstantiationAwareBeanPostProcessor;</span>
<span class="token comment">//就执行postProcessBeforeInstantiation</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	bean <span class="token operator">=</span> <span class="token function">applyBeanPostProcessorsAfterInitialization</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol></li> <li><p>doCreateBean(beanName,mbdToUse,args)和上面3.6一致</p></li></ol></li></ol></li></ol></li> <li></li> <li></li></ol> <p>​</p> <h3 id="声明式事务"><a href="#声明式事务" class="header-anchor">#</a> 声明式事务：</h3> <p><code>@EnableTransctionManagement：</code> 开启基于注解的事务管理功能；</p> <p><code>@Transactional</code>: 给方法上标注 @Transactional 表示当前方法是一个事务方法；</p> <h3 id="扩展原理"><a href="#扩展原理" class="header-anchor">#</a> 扩展原理</h3> <h4 id="beanfactorypostprocessor"><a href="#beanfactorypostprocessor" class="header-anchor">#</a> BeanFactoryPostProcessor</h4> <p>与BeanFactoryPostProcessor相似的还有一个是BeanPostProcessor。先看下二则的区别：</p> <p><strong>BeanPostProcessor</strong>:bean后置处理器，bean创建对象初始化前后进行拦截工作。</p> <p><strong>BeanFacrotyPostProcessor</strong>：是beanFactory的后置处理器，在BeanFactory标准初始化后调用，来定制和修改BeanFactory的内容此时所有的bean定义已经保存加载到beanFactory,但bean的实例还未创建。</p> <h5 id="beanfactorypostprocessor原理"><a href="#beanfactorypostprocessor原理" class="header-anchor">#</a> BeanFactoryPostProcessor原理</h5> <h4 id="beandefinitionregisterpostprocessor"><a href="#beandefinitionregisterpostprocessor" class="header-anchor">#</a> BeanDefinitionRegisterPostProcessor</h4> <p>在所有bean定义信息将要被加载，bean实例还未创建的。优先于BeanFactoryPostProcessor执行，利用BeanDefinitionRegistryPostProcessor给容器中再额外添加一些组件。</p> <h5 id="beandefinitionregisterpostprocessor原理"><a href="#beandefinitionregisterpostprocessor原理" class="header-anchor">#</a> BeanDefinitionRegisterPostProcessor原理</h5> <ol><li>ioc创建对象</li> <li>refresh()---&gt;invokeBeanFactoryPostProcessor(beanFactory);</li> <li>从容器中获取到所有的BeanDefinitionRegistryPostProcessor组件
<ol><li>依次触发所有的postProcessBeanDefinitionRegistry()方法</li> <li>再进行触发postPrcessBeanFactory()方法 BeanFactoryPostProcessor</li></ol></li> <li>再从容器中找到BeanFactoryPostProcessor组件，然后依次触发postPrcessBeanFactory()方法</li></ol> <h4 id="applicationlistener"><a href="#applicationlistener" class="header-anchor">#</a> ApplicationListener</h4> <p>用于监听容器中发布的事件，事件驱动模型开发。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span> <span class="token keyword">extends</span> <span class="token class-name">ApplicationEvent</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>使用步骤：</strong></p> <ol><li>写一个监听器(ApplicationListener实现类)来监听某个事件(ApplicationEvent及其子类)</li> <li>把监听器加入到容器</li> <li>只要容器中有相关事件的发布，我们就能监听到这个事件
<ol><li>ContextRefreshEvent:容器刷新完成（所有bean都会创建）会发布这个事件</li> <li>ContextCloasedEvent:关闭容器会发布这个事件</li></ol></li> <li>发布一个事件：application.pushEvent.</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApplicationListener</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationEvent</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

	<span class="token comment">//当容器中发布此事件以后，方法触发</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;收到事件：&quot;</span><span class="token operator">+</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.atguigu.ext&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExtConfig</span> <span class="token punctuation">{</span>
	
	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">Blue</span> <span class="token function">blue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Blue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IOCTest_Ext</span> <span class="token punctuation">{</span>
	
	<span class="token annotation punctuation">@Test</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">AnnotationConfigApplicationContext</span> applicationContext  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ExtConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		
		<span class="token comment">//发布事件；</span>
		applicationContext<span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ApplicationEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;我发布的时间&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		applicationContext<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h5 id="applicationlistener的原理"><a href="#applicationlistener的原理" class="header-anchor">#</a> ApplicationListener的原理</h5> <h4 id="spring容器创建过程"><a href="#spring容器创建过程" class="header-anchor">#</a> Spring容器创建过程</h4> <h3 id="springmvc注解"><a href="#springmvc注解" class="header-anchor">#</a> SpringMVC注解：</h3> <p>除了spring的基本注解你还可以使用下面的注解</p> <p><code>@EnableWebMvc:</code>  在配置类中开启Web MVC的配置支持，如一些ViewResolver或者MessageConverter等，若无此句，重写WebMvcConfigurerAdapter方法（用于对SpringMVC的配置）</p> <p><code>@RequestMapping(&quot;item/{id}&quot;)</code>  声明请求的url{xxx}叫做占位符，请求的URL可以是“item /1”或“item/2”</p> <p><code>@PathVariable</code>获取url上的数据</p> <div class="language-java extra-class"><pre class="language-java"><code>使用<span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span>获取url上的数据		
<span class="token comment">/**
* 使用RESTful风格开发接口，实现根据id查询商品
* 如果不一致，例如&quot;item/{ItemId}&quot;则需要指定名称@PathVariable(&quot;itemId&quot;)。
* @param id
* @return
*/</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;item/{id}&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">Item</span> <span class="token function">queryItemById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Item</span> item <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>itemService<span class="token punctuation">.</span><span class="token function">queryItemById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> item<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
			
</code></pre></div><p><code>@PathVariable</code>:  是 获取 url 上数据 的。 @RequestParam获取请求参数的（包括post表单提交）</p> <p><code>@ResponseBody</code> :使用这个注解就不会走视图解析器，不会返回页面，目前返回的json数据。如果不加，就走视图解析器，返回页面</p> <p><code>@RequestBody</code>：  允许request的参数在request体中，而不是在直接连接在地址后面。（放在参数前） 需要和postMapping一起使用</p> <p><code>@NumberFormat</code> ：   支持对数字类型的属性使用 @NumberFormat 注解</p> <p><code>@DateTimeFormat</code>： – JodaDateTimeFormatAnnotationFormatterFactroy：支持对日期类型的属性使用 @DateTimeFormat 注解 ；可以对pattern 属性：类型为字符串。指定解析/格式化字段数据的模式，如：”yyyy-MM-dd hh:mm:ss”等其他的</p> <p><code>@RequestParam(name=&quot;file&quot;)</code>:接收前端传入的参数 required=false或者true来要@RequestParam配置的前端参数是否一定要传</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue-press/guide/Spring Security.html" class="prev">
        Spring Security
      </a></span> <span class="next"><a href="/vue-press/guide/tkmybatis.html">
        tkmybatis
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/vue-press/assets/js/app.8857885a.js" defer></script><script src="/vue-press/assets/js/2.c05b7fa4.js" defer></script><script src="/vue-press/assets/js/43.b9f83c8a.js" defer></script>
  </body>
</html>
